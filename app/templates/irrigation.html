{% extends "base.html" %}
{% block title %}Sistema de Riego{% endblock %}

{% block content %}

<div class="irrigation-header">
  <h2>ğŸ’§ Sistema de Riego Inteligente</h2>
  <div class="system-status">
    <span class="status-indicator" id="systemStatus">
      <i class="status-dot"></i> Sistema Activo
    </span>
    <span class="last-update" id="lastUpdate">Actualizando...</span>
  </div>
</div>

<!-- Control Manual de Zonas -->
<div class="card card-zones">
  <div class="card-header">
    <h3>ğŸ›ï¸ Control Manual de Zonas</h3>
    <button class="btn-emergency" onclick="emergencyStop()">
      <span class="btn-icon">âš ï¸</span> Detener Todo
    </button>
  </div>
  <div class="zones-grid" id="zonesGrid">
    <!-- Zones will be loaded dynamically -->
  </div>
</div>

<!-- ProgramaciÃ³n de Riego -->
<div class="card card-schedule">
  <div class="card-header">
    <h3>ğŸ“… Programar Nuevo Riego</h3>
  </div>
  <div class="schedule-form">
    <div class="form-row">
      <div class="form-group">
        <label for="sector">
          <i class="icon">ğŸŒ±</i> Sector
        </label>
        <select id="sector" class="form-control">
          <option value="4">Sector 4 - Ãrboles (Prioridad 1 â­)</option>
          <option value="1">Sector 1 - JardÃ­n Principal (Prioridad 2 â­â­)</option>
          <option value="2">Sector 2 - Huerta (Prioridad 3 â­â­â­)</option>
          <option value="3">Sector 3 - CÃ©sped (Prioridad 4 â­â­â­â­)</option>
        </select>
      </div>

      <div class="form-group">
        <label for="date">
          <i class="icon">ğŸ“†</i> Fecha
        </label>
        <input type="date" id="date" class="form-control" required>
      </div>
    </div>

    <div class="form-row">
      <div class="form-group">
        <label for="time">
          <i class="icon">â°</i> Hora de Inicio
        </label>
        <input type="time" id="time" class="form-control" required>
      </div>

      <div class="form-group">
        <label for="end_time">
          <i class="icon">â±ï¸</i> Hora de Fin
        </label>
        <input type="time" id="end_time" class="form-control" required>
      </div>
    </div>

    <!-- RepeticiÃ³n Semanal -->
    <div class="form-group-full">
      <label for="repeatEnabled">
        <input type="checkbox" id="repeatEnabled" onchange="toggleRepeatDays()">
        <span class="repeat-label">ğŸ”„ Repetir automÃ¡ticamente cada semana</span>
      </label>
    </div>

    <div id="repeatDaysContainer" class="repeat-days-container" style="display: none;">
      <label class="repeat-label">Selecciona los dÃ­as:</label>
      <div class="repeat-days-grid">
        <div class="day-checkbox">
          <input type="checkbox" id="dayL" class="day-check" value="L">
          <label for="dayL">L</label>
        </div>
        <div class="day-checkbox">
          <input type="checkbox" id="dayM" class="day-check" value="M">
          <label for="dayM">M</label>
        </div>
        <div class="day-checkbox">
          <input type="checkbox" id="dayX" class="day-check" value="X">
          <label for="dayX">X</label>
        </div>
        <div class="day-checkbox">
          <input type="checkbox" id="dayJ" class="day-check" value="J">
          <label for="dayJ">J</label>
        </div>
        <div class="day-checkbox">
          <input type="checkbox" id="dayV" class="day-check" value="V">
          <label for="dayV">V</label>
        </div>
        <div class="day-checkbox">
          <input type="checkbox" id="dayS" class="day-check" value="S">
          <label for="dayS">S</label>
        </div>
        <div class="day-checkbox">
          <input type="checkbox" id="dayD" class="day-check" value="D">
          <label for="dayD">D</label>
        </div>
      </div>
    </div>

    <div class="form-actions">
      <button class="btn btn-primary" onclick="createSchedule()">
        <span class="btn-icon">âœ“</span> Programar Riego
      </button>
      <button class="btn btn-secondary" onclick="clearForm()">
        <span class="btn-icon">âœ•</span> Limpiar
      </button>
    </div>
  </div>
</div>

<!-- Riegos Programados -->
<div class="card card-scheduled">
  <div class="card-header">
    <h3>ğŸ“‹ Riegos Programados</h3>
    <span class="badge" id="scheduledCount">0</span>
  </div>
  <div id="scheduleList" class="schedule-list">
    <div class="loading">
      <div class="spinner"></div>
      <p>Cargando programaciÃ³n...</p>
    </div>
  </div>
</div>

<!-- Historial de Riegos -->
<div class="card card-history">
  <div class="card-header">
    <h3>ğŸ“Š Historial de Riegos</h3>
    <div class="history-filters">
      <button class="filter-btn active" onclick="filterHistory('all')">Todos</button>
      <button class="filter-btn" onclick="filterHistory('manual')">Manual</button>
      <button class="filter-btn" onclick="filterHistory('scheduled')">Programado</button>
    </div>
  </div>
  <div id="historyList" class="history-list">
    <div class="loading">
      <div class="spinner"></div>
      <p>Cargando historial...</p>
    </div>
  </div>
</div>

{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/irrigation.js') }}"></script>
{% endblock %}
